# Система мониторинга и оптимизации инвестиционного портфеля

Данный проект представляет собой комплексную систему для мониторинга, анализа и оптимизации инвестиционных портфелей с использованием современных методов машинного обучения и MLOps практик.

## Основные компоненты

Система построена на микросервисной архитектуре и включает в себя:

- **Frontend (Пользовательский интерфейс)**: Разработан на Streamlit, обеспечивает интерактивное взаимодействие с пользователем, визуализацию данных и управление портфелями.
- **Backend (Серверная часть)**: Реализован на FastAPI, предоставляет RESTful API для взаимодействия с frontend и другими компонентами системы, управляет бизнес-логикой и аутентификацией пользователей (JWT).
- **Асинхронные задачи**: Оркестрируются с помощью Celery, RabbitMQ (как брокер сообщений) и Redis (для хранения результатов и как бэкенд Celery). Используются для выполнения длительных операций, таких как обучение моделей, бэктестинг и анализ новостей.
- **База данных**: PostgreSQL используется для хранения пользовательских данных, информации о портфелях, активах и транзакциях. Миграции базы данных управляются с помощью Alembic.
- **MLOps**: ClearML интегрирован для полного цикла MLOps, включая управление наборами данных (версионирование, хранение), отслеживание экспериментов, обучение моделей (CatBoost, DRL), регистрацию моделей и их развертывание (через ClearML Serving).
- **Модели машинного обучения**:
    - *CatBoost*: для прогнозирования цен активов.
    - *Deep Reinforcement Learning (DRL)*: агенты (например, PPO на базе FinRL/Stable-Baselines3) для динамической ребалансировки портфеля.
    - *NLP модели (FinBERT, Llama3)*: для анализа тональности новостей и интеграции с чат-ботом (в планах).
- **Контейнеризация**: Docker и Docker Compose используются для упрощения развертывания и управления всеми сервисами системы.

## Функциональные возможности

- **Личный кабинет пользователя**: Регистрация, аутентификация, управление профилем.
- **Управление портфелями**: Создание и отслеживание нескольких инвестиционных портфелей.
- **Торговый аккаунт**: Учет и добавление транзакций (покупка/продажа активов).
- **Анализ портфеля**: Расчет текущей стоимости, доходности, P&L, распределения активов (визуализация с помощью графиков и диаграмм).
- **Прогнозирование цен**: Отображение прогнозов цен для выбранных активов.
- **Оптимизация и ребалансировка портфеля**: Получение рекомендаций по ребалансировке на основе DRL моделей.
- **Анализ новостей**: Агрегация и анализ тональности новостей по выбранным активам.
- **Исследование и бэктестинг**: Возможность запуска симуляций и бэктестов для гипотетических портфелей и стратегий.
- **Запуск ML пайплайнов**: Интерфейс для инициации процессов обучения и обновления моделей через ClearML.
- **Взаимодействие с моделями**: Получение предсказаний от развернутых моделей через ClearML Serving.

## Технологический стек

- **Python 3.10+**
- **Frontend**: Streamlit
- **Backend**: FastAPI, Uvicorn
- **База данных**: PostgreSQL, SQLAlchemy, Alembic
- **Асинхронные задачи**: Celery, RabbitMQ, Redis
- **ML/Data Science**: Pandas, NumPy, Scikit-learn, CatBoost, FinRL, Stable-Baselines3, TA-Lib, Transformers, PyTorch/TensorFlow (для NLP)
- **MLOps**: ClearML, Hydra (для конфигурации ML экспериментов)
- **Контейнеризация**: Docker, Docker Compose
- **Прочее**: Pydantic, python-jose (JWT), httpx

## Развертывание и запуск

Проект полностью контейнеризован с использованием Docker Compose. Для запуска всех сервисов системы:

1.  **Клонируйте репозиторий**:
    ```bash
    git clone <URL_репозитория>
    cd <название_директории_проекта>
    ```
2.  **Конфигурация**: 
    Скопируйте `.env.example` в `.env` и заполните необходимые переменные окружения (ключи API, параметры подключения к БД и т.д.).
    ```bash
    cp .env.example .env
    # Отредактируйте .env файл
    ```
3.  **Сборка и запуск контейнеров**:
    ```bash
    docker-compose up --build -d
    ```
    Эта команда соберет образы (если они еще не собраны) и запустит все сервисы в фоновом режиме.

4.  **Доступ к приложениям**:
    - **Frontend (Streamlit)**: `http://localhost:8501` (или порт, указанный в `docker-compose.yml`)
    - **Backend (FastAPI Docs)**: `http://localhost:8000/docs` (или порт, указанный в `docker-compose.yml`)
    - **RabbitMQ Management**: `http://localhost:15672` (логин/пароль по умолчанию: guest/guest)
    - **ClearML Server**: Если вы разворачиваете свой сервер ClearML, укажите его адрес. Для использования публичного сервера ClearML, настройте ваши ClearML credentials.

5.  **Применение миграций базы данных** (при первом запуске или после изменения схемы):
    Миграции Alembic должны применяться автоматически при старте backend контейнера благодаря `entrypoint.sh`.
    Если требуется ручное применение:
    ```bash
    docker-compose exec backend alembic upgrade head
    ```

## Структура проекта (упрощенная)

```
.
├── backend/                  # Бэкенд FastAPI, Celery worker, ML модели, скрипты MLOps
│   ├── app/                  # Код FastAPI приложения (API, модели БД, сервисы)
│   ├── worker/               # Код Celery worker и задачи
│   ├── ml_models/            # Скрипты обучения, конфигурации ML моделей, пайплайны ClearML
│   ├── data_pipelines/       # Скрипты получения и обработки данных, пайплайны ClearML
│   └── Dockerfile            # Dockerfile для бэкенда и воркера
├── frontend/                 # Frontend Streamlit (в Docker контейнере)
│   ├── Dockerfile.streamlit  # Dockerfile для Streamlit
│   └── src/                  # Исходный код Streamlit приложения (страницы, компоненты)
├── configs/                  # Конфигурационные файлы Hydra для ML и данных
├── notebooks/                # Jupyter ноутбуки для исследований и экспериментов
├── docker-compose.yml        # Файл Docker Compose для оркестрации всех сервисов
├── pyproject.toml            # Зависимости проекта и конфигурация Poetry
├── alembic.ini               # Конфигурация Alembic
├── entrypoint.sh             # Скрипт для запуска миграций в Docker
└── README.md                 # Этот файл
```

## Вклад в проект

Предложения и Pull Request-ы приветствуются! Пожалуйста, придерживайтесь установленных стандартов кодирования и подробно описывайте вносимые изменения.

## Лицензия

Проект распространяется под лицензией MIT. Подробности смотрите в файле `LICENSE` (если он существует).
